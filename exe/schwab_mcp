#!/usr/bin/env ruby

require_relative "../lib/schwab_mcp"
require "dotenv"

Dotenv.load

required_vars = [
  'SCHWAB_API_KEY',
  'SCHWAB_APP_SECRET',
  'SCHWAB_CALLBACK_URI',
  'SCHWAB_TOKEN_PATH'
]
missing_vars = required_vars.select { |var| ENV[var].nil? || ENV[var].empty? }

unless missing_vars.empty?
  STDERR.puts "Missing required environment variables: #{missing_vars.join(', ')}"
  exit 1
end

STDERR.puts "All required environment variables are set."

begin
  STDERR.puts "Starting Schwab MCP server..."
  SchwabMCP::Server.new.start
rescue StandardError => e
  STDERR.puts "Error starting Schwab MCP server: #{e.message}"
  STDERR.puts e.backtrace.join("\n")
  exit 1
end